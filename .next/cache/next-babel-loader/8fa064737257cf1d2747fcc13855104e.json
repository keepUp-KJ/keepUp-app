{"ast":null,"code":"\"use strict\";var _classCallCheck=require(\"@babel/runtime/helpers/classCallCheck\");var _createClass=require(\"@babel/runtime/helpers/createClass\");var _interopRequireDefault=require(\"@babel/runtime/helpers/interopRequireDefault\");exports.__esModule=true;exports[\"default\"]=void 0;var _mitt=_interopRequireDefault(require(\"../next-server/lib/mitt\"));var _router=require(\"../next-server/lib/router/router\");var _escapePathDelimiters=_interopRequireDefault(require(\"../next-server/lib/router/utils/escape-path-delimiters\"));var _getAssetPathFromRoute=_interopRequireDefault(require(\"./../next-server/lib/router/utils/get-asset-path-from-route\"));var _isDynamic=require(\"./../next-server/lib/router/utils/is-dynamic\");var _parseRelativeUrl=require(\"./../next-server/lib/router/utils/parse-relative-url\");var _querystring=require(\"./../next-server/lib/router/utils/querystring\");var _routeMatcher=require(\"./../next-server/lib/router/utils/route-matcher\");var _routeRegex=require(\"./../next-server/lib/router/utils/route-regex\");function hasRel(rel,link){try{link=document.createElement('link');return link.relList.supports(rel);}catch(_unused){}}function pageLoadError(route){return(0,_router.markLoadingError)(new Error(\"Error loading \".concat(route)));}var relPrefetch=hasRel('preload')&&!hasRel('prefetch')?'preload':'prefetch';var hasNoModule=('noModule'in document.createElement('script'));var requestIdleCallback=window.requestIdleCallback||function(cb){return setTimeout(cb,1);};function normalizeRoute(route){if(route[0]!=='/'){throw new Error(\"Route name should start with a \\\"/\\\", got \\\"\".concat(route,\"\\\"\"));}if(route==='/')return route;return route.replace(/\\/$/,'');}function appendLink(href,rel,as){return new Promise(function(res,rej,link){link=document.createElement('link');link.crossOrigin=process.env.__NEXT_CROSS_ORIGIN;link.href=href;link.rel=rel;if(as)link.as=as;link.onload=res;link.onerror=rej;document.head.appendChild(link);});}var PageLoader=function(){function PageLoader(buildId,assetPrefix,initialPage){_classCallCheck(this,PageLoader);this.buildId=buildId;this.assetPrefix=assetPrefix;this.pageCache={};this.pageRegisterEvents=(0,_mitt[\"default\"])();this.loadingRoutes={'/_app':true};if(initialPage!=='/_error'){this.loadingRoutes[initialPage]=true;}if(false){this.promisedBuildManifest=new Promise(function(resolve){if(window.__BUILD_MANIFEST){resolve(window.__BUILD_MANIFEST);}else{window.__BUILD_MANIFEST_CB=function(){resolve(window.__BUILD_MANIFEST);};}});}this.promisedSsgManifest=new Promise(function(resolve){if(window.__SSG_MANIFEST){resolve(window.__SSG_MANIFEST);}else{window.__SSG_MANIFEST_CB=function(){resolve(window.__SSG_MANIFEST);};}});}_createClass(PageLoader,[{key:\"getDependencies\",value:function getDependencies(route){var _this=this;return this.promisedBuildManifest.then(function(m){var _this$pageRegisterEve;return m[route]?m[route].map(function(url){return\"\".concat(_this.assetPrefix,\"/_next/\").concat(encodeURI(url));}):(_this$pageRegisterEve=_this.pageRegisterEvents.emit(route,{error:pageLoadError(route)}))!=null?_this$pageRegisterEve:[];});}},{key:\"getDataHref\",value:function getDataHref(href,asPath,ssg){var _this2=this;var _ref=(0,_parseRelativeUrl.parseRelativeUrl)(href),hrefPathname=_ref.pathname,searchParams=_ref.searchParams,search=_ref.search;var query=(0,_querystring.searchParamsToUrlQuery)(searchParams);var _ref2=(0,_parseRelativeUrl.parseRelativeUrl)(asPath),asPathname=_ref2.pathname;var route=normalizeRoute(hrefPathname);var getHrefForSlug=function getHrefForSlug(path){var dataRoute=(0,_getAssetPathFromRoute[\"default\"])(path,'.json');return(0,_router.addBasePath)(\"/_next/data/\".concat(_this2.buildId).concat(dataRoute).concat(ssg?'':search));};var isDynamic=(0,_isDynamic.isDynamicRoute)(route),interpolatedRoute;if(isDynamic){var dynamicRegex=(0,_routeRegex.getRouteRegex)(route);var dynamicGroups=dynamicRegex.groups;var dynamicMatches=(0,_routeMatcher.getRouteMatcher)(dynamicRegex)(asPathname)||query;interpolatedRoute=route;if(!Object.keys(dynamicGroups).every(function(param){var value=dynamicMatches[param]||'';var _dynamicGroups$param=dynamicGroups[param],repeat=_dynamicGroups$param.repeat,optional=_dynamicGroups$param.optional;var replaced=\"[\".concat(repeat?'...':'').concat(param,\"]\");if(optional){replaced=\"\".concat(!value?'/':'',\"[\").concat(replaced,\"]\");}if(repeat&&!Array.isArray(value))value=[value];return(optional||param in dynamicMatches)&&(interpolatedRoute=interpolatedRoute.replace(replaced,repeat?value.map(_escapePathDelimiters[\"default\"]).join('/'):(0,_escapePathDelimiters[\"default\"])(value))||'/');})){interpolatedRoute='';}}return isDynamic?interpolatedRoute&&getHrefForSlug(interpolatedRoute):getHrefForSlug(route);}},{key:\"prefetchData\",value:function prefetchData(href,asPath){var _this3=this;var _ref3=(0,_parseRelativeUrl.parseRelativeUrl)(href),hrefPathname=_ref3.pathname;var route=normalizeRoute(hrefPathname);return this.promisedSsgManifest.then(function(s,_dataHref){requestIdleCallback(function(){s.has(route)&&(_dataHref=_this3.getDataHref(href,asPath,true))&&!document.querySelector(\"link[rel=\\\"\".concat(relPrefetch,\"\\\"][href^=\\\"\").concat(_dataHref,\"\\\"]\"))&&appendLink(_dataHref,relPrefetch,'fetch');});});}},{key:\"loadPage\",value:function loadPage(route){var _this4=this;route=normalizeRoute(route);return new Promise(function(resolve,reject){var cachedPage=_this4.pageCache[route];if(cachedPage){var error=cachedPage.error,page=cachedPage.page,mod=cachedPage.mod;error?reject(error):resolve({page:page,mod:mod});return;}var fire=function fire(_ref4){var error=_ref4.error,page=_ref4.page,mod=_ref4.mod;_this4.pageRegisterEvents.off(route,fire);delete _this4.loadingRoutes[route];if(error){reject(error);}else{resolve({page:page,mod:mod});}};_this4.pageRegisterEvents.on(route,fire);if(!_this4.loadingRoutes[route]){_this4.loadingRoutes[route]=true;if(false){_this4.getDependencies(route).then(function(deps){deps.forEach(function(d){if(d.endsWith('.js')&&!document.querySelector(\"script[src^=\\\"\".concat(d,\"\\\"]\"))){_this4.loadScript(d,route);}if(d.endsWith('.css')&&!document.querySelector(\"link[rel=stylesheet][href^=\\\"\".concat(d,\"\\\"]\"))){appendLink(d,'stylesheet')[\"catch\"](function(){});}});});}else{route=normalizeRoute(route);var scriptRoute=(0,_getAssetPathFromRoute[\"default\"])(route,'.js');var url=\"\".concat(_this4.assetPrefix,\"/_next/static/chunks/pages\").concat(encodeURI(scriptRoute));_this4.loadScript(url,route);}}});}},{key:\"loadScript\",value:function loadScript(url,route){var _this5=this;var script=document.createElement('script');if(process.env.__NEXT_MODERN_BUILD&&hasNoModule){script.type='module';}script.crossOrigin=process.env.__NEXT_CROSS_ORIGIN;script.src=url;script.onerror=function(){_this5.pageRegisterEvents.emit(route,{error:pageLoadError(url)});};document.body.appendChild(script);}},{key:\"registerPage\",value:function registerPage(route,regFn){var _this6=this;var register=function register(){try{var mod=regFn();var pageData={page:mod[\"default\"]||mod,mod:mod};_this6.pageCache[route]=pageData;_this6.pageRegisterEvents.emit(route,pageData);}catch(error){_this6.pageCache[route]={error:error};_this6.pageRegisterEvents.emit(route,{error:error});}};if(true){if(module.hot&&module.hot.status()!=='idle'){console.log(\"Waiting for webpack to become \\\"idle\\\" to initialize the page: \\\"\".concat(route,\"\\\"\"));var check=function check(status){if(status==='idle'){module.hot.removeStatusHandler(check);register();}};module.hot.status(check);return;}}register();}},{key:\"prefetch\",value:function prefetch(route,isDependency){var _this7=this;var cn;if(cn=navigator.connection){if(cn.saveData||/2g/.test(cn.effectiveType))return Promise.resolve();}var url;if(isDependency){url=route;}else{if(true){route=normalizeRoute(route);var ext=process.env.__NEXT_MODERN_BUILD&&hasNoModule?'.module.js':'.js';var scriptRoute=(0,_getAssetPathFromRoute[\"default\"])(route,ext);url=\"\".concat(this.assetPrefix,\"/_next/static/\").concat(encodeURIComponent(this.buildId),\"/pages\").concat(encodeURI(scriptRoute));}}return Promise.all(document.querySelector(\"link[rel=\\\"\".concat(relPrefetch,\"\\\"][href^=\\\"\").concat(url,\"\\\"]\"))?[]:[url&&appendLink(url,relPrefetch,url.endsWith('.css')?'style':'script'),false&&!isDependency&&this.getDependencies(route).then(function(urls){return Promise.all(urls.map(function(dependencyUrl){return _this7.prefetch(dependencyUrl,true);}));})]).then(function(){},function(){});}}]);return PageLoader;}();exports[\"default\"]=PageLoader;","map":{"version":3,"sources":["../../client/page-loader.js"],"names":["link","document","relPrefetch","hasRel","hasNoModule","requestIdleCallback","window","setTimeout","route","process","PageLoader","constructor","initialPage","resolve","m","url","assetPrefix","encodeURI","error","pageLoadError","pathname","query","normalizeRoute","getHrefForSlug","path","dataRoute","buildId","ssg","isDynamic","dynamicRegex","dynamicGroups","dynamicMatches","interpolatedRoute","Object","param","value","replaced","repeat","Array","optional","escapePathDelimiters","s","_dataHref","appendLink","loadPage","cachedPage","reject","page","mod","fire","deps","d","scriptRoute","loadScript","script","register","regFn","pageData","module","console","check","status","cn","navigator","Promise","ext","encodeURIComponent","urls","dependencyUrl"],"mappings":"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","sourcesContent":["import mitt from '../next-server/lib/mitt'\nimport { addBasePath, markLoadingError } from '../next-server/lib/router/router'\nimport escapePathDelimiters from '../next-server/lib/router/utils/escape-path-delimiters'\nimport getAssetPathFromRoute from './../next-server/lib/router/utils/get-asset-path-from-route'\nimport { isDynamicRoute } from './../next-server/lib/router/utils/is-dynamic'\nimport { parseRelativeUrl } from './../next-server/lib/router/utils/parse-relative-url'\nimport { searchParamsToUrlQuery } from './../next-server/lib/router/utils/querystring'\nimport { getRouteMatcher } from './../next-server/lib/router/utils/route-matcher'\nimport { getRouteRegex } from './../next-server/lib/router/utils/route-regex'\n\nfunction hasRel(rel, link) {\n  try {\n    link = document.createElement('link')\n    return link.relList.supports(rel)\n  } catch {}\n}\n\nfunction pageLoadError(route) {\n  return markLoadingError(new Error(`Error loading ${route}`))\n}\n\nconst relPrefetch =\n  hasRel('preload') && !hasRel('prefetch')\n    ? // https://caniuse.com/#feat=link-rel-preload\n      // macOS and iOS (Safari does not support prefetch)\n      'preload'\n    : // https://caniuse.com/#feat=link-rel-prefetch\n      // IE 11, Edge 12+, nearly all evergreen\n      'prefetch'\n\nconst hasNoModule = 'noModule' in document.createElement('script')\n\nconst requestIdleCallback =\n  window.requestIdleCallback ||\n  function (cb) {\n    return setTimeout(cb, 1)\n  }\n\n/** @param {string} route */\nfunction normalizeRoute(route) {\n  if (route[0] !== '/') {\n    throw new Error(`Route name should start with a \"/\", got \"${route}\"`)\n  }\n\n  if (route === '/') return route\n  return route.replace(/\\/$/, '')\n}\n\nfunction appendLink(href, rel, as) {\n  return new Promise((res, rej, link) => {\n    link = document.createElement('link')\n    link.crossOrigin = process.env.__NEXT_CROSS_ORIGIN\n    link.href = href\n    link.rel = rel\n    if (as) link.as = as\n\n    link.onload = res\n    link.onerror = rej\n\n    document.head.appendChild(link)\n  })\n}\n\nexport default class PageLoader {\n  constructor(buildId, assetPrefix, initialPage) {\n    this.buildId = buildId\n    this.assetPrefix = assetPrefix\n\n    this.pageCache = {}\n    this.pageRegisterEvents = mitt()\n    this.loadingRoutes = {\n      // By default these 2 pages are being loaded in the initial html\n      '/_app': true,\n    }\n\n    // TODO: get rid of this limitation for rendering the error page\n    if (initialPage !== '/_error') {\n      this.loadingRoutes[initialPage] = true\n    }\n\n    if (process.env.NODE_ENV === 'production') {\n      this.promisedBuildManifest = new Promise((resolve) => {\n        if (window.__BUILD_MANIFEST) {\n          resolve(window.__BUILD_MANIFEST)\n        } else {\n          window.__BUILD_MANIFEST_CB = () => {\n            resolve(window.__BUILD_MANIFEST)\n          }\n        }\n      })\n    }\n    /** @type {Promise<Set<string>>} */\n    this.promisedSsgManifest = new Promise((resolve) => {\n      if (window.__SSG_MANIFEST) {\n        resolve(window.__SSG_MANIFEST)\n      } else {\n        window.__SSG_MANIFEST_CB = () => {\n          resolve(window.__SSG_MANIFEST)\n        }\n      }\n    })\n  }\n\n  // Returns a promise for the dependencies for a particular route\n  getDependencies(route) {\n    return this.promisedBuildManifest.then((m) => {\n      return m[route]\n        ? m[route].map((url) => `${this.assetPrefix}/_next/${encodeURI(url)}`)\n        : this.pageRegisterEvents.emit(route, {\n            error: pageLoadError(route),\n          }) ?? []\n    })\n  }\n\n  /**\n   * @param {string} href the route href (file-system path)\n   * @param {string} asPath the URL as shown in browser (virtual path); used for dynamic routes\n   */\n  getDataHref(href, asPath, ssg) {\n    const { pathname: hrefPathname, searchParams, search } = parseRelativeUrl(\n      href\n    )\n    const query = searchParamsToUrlQuery(searchParams)\n    const { pathname: asPathname } = parseRelativeUrl(asPath)\n    const route = normalizeRoute(hrefPathname)\n\n    const getHrefForSlug = (/** @type string */ path) => {\n      const dataRoute = getAssetPathFromRoute(path, '.json')\n      return addBasePath(\n        `/_next/data/${this.buildId}${dataRoute}${ssg ? '' : search}`\n      )\n    }\n\n    let isDynamic = isDynamicRoute(route),\n      interpolatedRoute\n    if (isDynamic) {\n      const dynamicRegex = getRouteRegex(route)\n      const dynamicGroups = dynamicRegex.groups\n      const dynamicMatches =\n        // Try to match the dynamic route against the asPath\n        getRouteMatcher(dynamicRegex)(asPathname) ||\n        // Fall back to reading the values from the href\n        // TODO: should this take priority; also need to change in the router.\n        query\n\n      interpolatedRoute = route\n      if (\n        !Object.keys(dynamicGroups).every((param) => {\n          let value = dynamicMatches[param] || ''\n          const { repeat, optional } = dynamicGroups[param]\n\n          // support single-level catch-all\n          // TODO: more robust handling for user-error (passing `/`)\n          let replaced = `[${repeat ? '...' : ''}${param}]`\n          if (optional) {\n            replaced = `${!value ? '/' : ''}[${replaced}]`\n          }\n          if (repeat && !Array.isArray(value)) value = [value]\n\n          return (\n            (optional || param in dynamicMatches) &&\n            // Interpolate group into data URL if present\n            (interpolatedRoute =\n              interpolatedRoute.replace(\n                replaced,\n                repeat\n                  ? value.map(escapePathDelimiters).join('/')\n                  : escapePathDelimiters(value)\n              ) || '/')\n          )\n        })\n      ) {\n        interpolatedRoute = '' // did not satisfy all requirements\n\n        // n.b. We ignore this error because we handle warning for this case in\n        // development in the `<Link>` component directly.\n      }\n    }\n\n    return isDynamic\n      ? interpolatedRoute && getHrefForSlug(interpolatedRoute)\n      : getHrefForSlug(route)\n  }\n\n  /**\n   * @param {string} href the route href (file-system path)\n   * @param {string} asPath the URL as shown in browser (virtual path); used for dynamic routes\n   */\n  prefetchData(href, asPath) {\n    const { pathname: hrefPathname } = parseRelativeUrl(href)\n    const route = normalizeRoute(hrefPathname)\n    return this.promisedSsgManifest.then((s, _dataHref) => {\n      requestIdleCallback(() => {\n        // Check if the route requires a data file\n        s.has(route) &&\n          // Try to generate data href, noop when falsy\n          (_dataHref = this.getDataHref(href, asPath, true)) &&\n          // noop when data has already been prefetched (dedupe)\n          !document.querySelector(\n            `link[rel=\"${relPrefetch}\"][href^=\"${_dataHref}\"]`\n          ) &&\n          // Inject the `<link rel=prefetch>` tag for above computed `href`.\n          appendLink(_dataHref, relPrefetch, 'fetch')\n      })\n    })\n  }\n\n  loadPage(route) {\n    route = normalizeRoute(route)\n\n    return new Promise((resolve, reject) => {\n      // If there's a cached version of the page, let's use it.\n      const cachedPage = this.pageCache[route]\n      if (cachedPage) {\n        const { error, page, mod } = cachedPage\n        error ? reject(error) : resolve({ page, mod })\n        return\n      }\n\n      const fire = ({ error, page, mod }) => {\n        this.pageRegisterEvents.off(route, fire)\n        delete this.loadingRoutes[route]\n\n        if (error) {\n          reject(error)\n        } else {\n          resolve({ page, mod })\n        }\n      }\n\n      // Register a listener to get the page\n      this.pageRegisterEvents.on(route, fire)\n\n      if (!this.loadingRoutes[route]) {\n        this.loadingRoutes[route] = true\n        if (process.env.NODE_ENV === 'production') {\n          this.getDependencies(route).then((deps) => {\n            deps.forEach((d) => {\n              if (\n                d.endsWith('.js') &&\n                !document.querySelector(`script[src^=\"${d}\"]`)\n              ) {\n                this.loadScript(d, route)\n              }\n              if (\n                d.endsWith('.css') &&\n                !document.querySelector(`link[rel=stylesheet][href^=\"${d}\"]`)\n              ) {\n                appendLink(d, 'stylesheet').catch(() => {\n                  // FIXME: handle failure\n                  // Right now, this is needed to prevent an unhandled rejection.\n                })\n              }\n            })\n          })\n        } else {\n          // Development only. In production the page file is part of the build manifest\n          route = normalizeRoute(route)\n          let scriptRoute = getAssetPathFromRoute(route, '.js')\n\n          const url = `${this.assetPrefix}/_next/static/chunks/pages${encodeURI(\n            scriptRoute\n          )}`\n          this.loadScript(url, route)\n        }\n      }\n    })\n  }\n\n  loadScript(url, route) {\n    const script = document.createElement('script')\n    if (process.env.__NEXT_MODERN_BUILD && hasNoModule) {\n      script.type = 'module'\n    }\n    script.crossOrigin = process.env.__NEXT_CROSS_ORIGIN\n    script.src = url\n    script.onerror = () => {\n      this.pageRegisterEvents.emit(route, { error: pageLoadError(url) })\n    }\n    document.body.appendChild(script)\n  }\n\n  // This method if called by the route code.\n  registerPage(route, regFn) {\n    const register = () => {\n      try {\n        const mod = regFn()\n        const pageData = { page: mod.default || mod, mod }\n        this.pageCache[route] = pageData\n        this.pageRegisterEvents.emit(route, pageData)\n      } catch (error) {\n        this.pageCache[route] = { error }\n        this.pageRegisterEvents.emit(route, { error })\n      }\n    }\n\n    if (process.env.NODE_ENV !== 'production') {\n      // Wait for webpack to become idle if it's not.\n      // More info: https://github.com/vercel/next.js/pull/1511\n      if (module.hot && module.hot.status() !== 'idle') {\n        console.log(\n          `Waiting for webpack to become \"idle\" to initialize the page: \"${route}\"`\n        )\n\n        const check = (status) => {\n          if (status === 'idle') {\n            module.hot.removeStatusHandler(check)\n            register()\n          }\n        }\n        module.hot.status(check)\n        return\n      }\n    }\n\n    register()\n  }\n\n  /**\n   * @param {string} route\n   * @param {boolean} [isDependency]\n   */\n  prefetch(route, isDependency) {\n    // https://github.com/GoogleChromeLabs/quicklink/blob/453a661fa1fa940e2d2e044452398e38c67a98fb/src/index.mjs#L115-L118\n    // License: Apache 2.0\n    let cn\n    if ((cn = navigator.connection)) {\n      // Don't prefetch if using 2G or if Save-Data is enabled.\n      if (cn.saveData || /2g/.test(cn.effectiveType)) return Promise.resolve()\n    }\n\n    /** @type {string} */\n    let url\n    if (isDependency) {\n      url = route\n    } else {\n      if (process.env.NODE_ENV !== 'production') {\n        route = normalizeRoute(route)\n\n        const ext =\n          process.env.__NEXT_MODERN_BUILD && hasNoModule ? '.module.js' : '.js'\n        const scriptRoute = getAssetPathFromRoute(route, ext)\n\n        url = `${this.assetPrefix}/_next/static/${encodeURIComponent(\n          this.buildId\n        )}/pages${encodeURI(scriptRoute)}`\n      }\n    }\n\n    return Promise.all(\n      document.querySelector(`link[rel=\"${relPrefetch}\"][href^=\"${url}\"]`)\n        ? []\n        : [\n            url &&\n              appendLink(\n                url,\n                relPrefetch,\n                url.endsWith('.css') ? 'style' : 'script'\n              ),\n            process.env.NODE_ENV === 'production' &&\n              !isDependency &&\n              this.getDependencies(route).then((urls) =>\n                Promise.all(\n                  urls.map((dependencyUrl) =>\n                    this.prefetch(dependencyUrl, true)\n                  )\n                )\n              ),\n          ]\n    ).then(\n      // do not return any data\n      () => {},\n      // swallow prefetch errors\n      () => {}\n    )\n  }\n}\n"]},"metadata":{},"sourceType":"script"}